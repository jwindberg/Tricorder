package com.example.tricorder.ui.components

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontFamily
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.example.tricorder.ui.theme.LcarsSourceColors

// Port of AxisElement.java (The Top "Absolute Vector" Section)
@Composable
fun LcarsVectorElement(
    x: Float, y: Float, z: Float,
    az: Float,
    alt: Float, // Added Altitude for Dial
    label: String,
    color: Color,
    modifier: Modifier = Modifier
) {
    // Layout: Header + Content
    Column(modifier = modifier) {
        // Header
        LcarsHeaderBarElement(
             text = label,
             color = color,
             modifier = Modifier.fillMaxWidth().height(50.dp)
        )
        
        Spacer(modifier = Modifier.height(4.dp))
        
        // AxisElement Layout:
        // Left Column: Y-Gauge (Top), Ell (Bottom)
        // Center Column: Axis (Top), X-Gauge (Bottom)
        // Right Section: Z-Gauge, Dial
        
        val barThickness = 6.dp 
        // In source, gauges are barThickness.
        
        Row(modifier = Modifier.fillMaxSize()) {
            // Main Plot Area (Y-Gauge, Axis, X-Gauge, Ell)
            Column(modifier = Modifier.weight(2f)) {
                
                // Top Row: Y-Gauge + Axis
                Row(modifier = Modifier.weight(1f).fillMaxWidth()) {
                     // Y-Gauge (Left) - Hardcoded Red
                     LcarsGaugeAtom(
                        value = (y + 1f) / 2f, 
                        color = LcarsSourceColors.COL_RED_STRICT, 
                        gridColor = color,
                        orientation = GaugeOrientation.LEFT,
                        modifier = Modifier.width(32.dp).fillMaxHeight() // Expanded for pointer
                     )
                     
                     Spacer(modifier = Modifier.width(4.dp))
                     
                     // Axis (Center)
                     LcarsAxis2DAtom(
                        x = x, 
                        y = y,
                        gridColor = color,
                        plotColor = LcarsSourceColors.COL_GRA_PLOT, 
                        modifier = Modifier.weight(1f).fillMaxHeight()
                     )
                }
                
                Spacer(modifier = Modifier.height(4.dp))
                
                // Bottom Row: Ell + X-Gauge
                Row(modifier = Modifier.height(32.dp).fillMaxWidth()) { // Expanded height for X-gauge pointer
                    // Ell (Corner) - Needs to fill the corner box properly.
                    // If Y-gauge is 32dp wide, and X-gauge is 32dp high.
                    // Ell should probably be 32dp wide x 32dp high to match the corner grid?
                    // But visual logic suggests it just connects the bars (12dp).
                    // Source EllAtom seems to just draw the corner.
                    LcarsEllAtom(
                        color = color,
                        modifier = Modifier.width(32.dp).fillMaxHeight()
                    )
                    
                    Spacer(modifier = Modifier.width(4.dp))
                    
                    // X-Gauge (Bottom) - Hardcoded Red
                    LcarsGaugeAtom(
                        value = (x + 1f) / 2f, 
                        color = LcarsSourceColors.COL_RED_STRICT,
                        gridColor = color,
                        orientation = GaugeOrientation.BOTTOM,
                        modifier = Modifier.weight(1f).fillMaxHeight()
                     )
                }
            }
            
            Spacer(modifier = Modifier.width(10.dp)) // Increased to ~10dp (moved right by ~1mm)
            
            // Z-Gauge (Middle-Right) - Hardcoded Red
            Column(modifier = Modifier.width(32.dp).fillMaxHeight(), horizontalAlignment = Alignment.CenterHorizontally) {
                 LcarsGaugeAtom(
                    value = z.coerceIn(0f, 1f),
                    color = LcarsSourceColors.COL_RED_STRICT,
                    gridColor = color,
                    orientation = GaugeOrientation.LEFT, // Standard Vertical
                    modifier = Modifier.width(32.dp).fillMaxHeight() // Expanded for pointer
                )
            }
            
            Spacer(modifier = Modifier.width(4.dp))
            
            // Dial (Far Right) - Hardcoded Red
            Column(modifier = Modifier.weight(1f).fillMaxHeight()) {
                 Box(
                    modifier = Modifier.weight(1f).fillMaxWidth().background(Color.Black)
                ) {
                    LcarsDialAtom(
                        angle = alt, 
                        gridColor = color, // Lavender Arc
                        plotColor = LcarsSourceColors.COL_RED_STRICT, // Red Pointer
                        strokeWidth = barThickness, 
                        modifier = Modifier.fillMaxSize().padding(4.dp)
                    )
                }
            }
        }
    }
}

// Port of MagnitudeElement.java (The Middle "Absolute Magnitude" Section)
@Composable
fun LcarsMagnitudeElement(
    value: Float,
    history: List<Float>,
    label: String,
    color: Color,
    modifier: Modifier = Modifier
) {
    Column(modifier = modifier) {
        LcarsHeaderBarElement(
             text = label,
             color = color,
             modifier = Modifier.fillMaxWidth().height(40.dp) // Thinner header
        )
        
        Spacer(modifier = Modifier.height(4.dp))
        
        Row(modifier = Modifier.fillMaxSize()) {
            // Chart (Left)
            Box(
                 modifier = Modifier
                    .weight(1f)
                    .fillMaxHeight()
                    .background(Color.Black)
            ) {
                LcarsChartGraph(
                    dataPoints = history,
                    gridColor = color,
                    plotColor = LcarsSourceColors.COL_GRA_PLOT, // Strict Orange Plot
                    modifier = Modifier.fillMaxSize()
                )
            }
             
             Spacer(modifier = Modifier.width(4.dp))
             
             // Mag Gauge (Right)
             Column(modifier = Modifier.width(40.dp).fillMaxHeight()) {
                 LcarsGaugeAtom(
                    value = value.coerceIn(0f, 1f),
                    color = LcarsSourceColors.COL_RED_STRICT, // Pointer Color
                    gridColor = color, // Bar Color
                    orientation = GaugeOrientation.RIGHT,
                    modifier = Modifier.weight(1f).fillMaxWidth()
                )
            }
        }
    }
}

// Port of Num3DElement.java (The Bottom "Absolute Data" Section)
@Composable
fun LcarsNum3DElement(
    x: Float, y: Float, z: Float,
    mag: Float, az: Float, alt: Float,
    label: String,
    color: Color,
    modifier: Modifier = Modifier
) {
    Column(modifier = modifier) {
        LcarsHeaderBarElement(
             text = label,
             color = color,
             modifier = Modifier.fillMaxWidth().height(40.dp) // Thinner header
        )
        
        Spacer(modifier = Modifier.height(4.dp))
        
        Row(modifier = Modifier.fillMaxSize()) {
            // Data Grid
            Column(modifier = Modifier.weight(1f)) {
                DataRow("X", x)
                DataRow("Y", y)
                DataRow("Z", z)
            }
            
            Column(modifier = Modifier.weight(1f)) {
                DataRow("AZI", az)
                DataRow("ALT", alt)
                DataRow("MAG", mag)
            }
            
            // Right Bar
            Box(modifier = Modifier.width(SIDE_BAR_WIDTH).fillMaxHeight().background(color))
        }
    }
}

@Composable
fun DataRow(label: String, value: Float) {
    Row(modifier = Modifier.fillMaxWidth().padding(vertical = 2.dp)) {
        Text(
            text = label,
            color = LcarsSourceColors.COL_TEXT_MED_LCARS,
            fontFamily = FontFamily.Monospace,
            fontSize = 16.sp,
            modifier = Modifier.width(40.dp)
        )
        Text(
            text = String.format("%.3f", value),
            color = LcarsSourceColors.COL_GRA_PLOT, // Strict Orange text for values
            fontFamily = FontFamily.Monospace,
            fontSize = 16.sp
        )
    }
}
